   <!-- ================= GRADES TAB ================= -->
<section x-show="page==='grades'" x-cloak class="space-y-6">

  <!-- Top summary header -->
  <div
    class="rounded-2xl bg-sand-100 border border-sand-200/70 shadow-card px-6 py-5 flex flex-col md:flex-row md:items-center md:justify-between gap-6">

    <!-- Left: Name + term + updated -->
    <div class="space-y-2">
      <div class="text-2xl md:text-3xl font-semibold text-slate-900" x-text="profileName"></div>
      <div class="flex flex-wrap items-center gap-2 text-xs">
        <span class="inline-flex items-center rounded-full bg-amber-500/90 text-white px-3 py-1 font-medium"
              x-text="selectedTerm">
        </span>
        <div class="inline-flex items-center gap-1 text-slate-500">
          <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M8 7V3m8 4V3M3 11h18M5 19h14"/>
          </svg>
          <span>Updated</span>
          <span x-text="currentUpdated()"></span>
        </div>
      </div>
    </div>

    <!-- Right: GPA + status -->
    <div class="flex-1 flex flex-col items-start md:items-end gap-3">
      <div class="text-right">
        <div class="text-xs uppercase tracking-wide text-slate-500">Current GPA</div>
        <div class="text-4xl font-semibold text-rust-600" x-text="currentGpa().toFixed(2)"></div>
        <div class="text-xs text-slate-500 mt-1">out of 4.0</div>
      </div>

      <div class="inline-flex items-center gap-2 rounded-2xl bg-amber-50 border border-amber-100 px-4 py-2">
        <svg class="h-4 w-4 text-amber-600" xmlns="http://www.w3.org/2000/svg" fill="none"
             viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.98a1 1 0 00.95.69h4.187c.969 0 1.371 1.24.588 1.81l-3.39 2.464a1 1 0 00-.364 1.118l1.286 3.98c.3.922-.755 1.688-1.54 1.118l-3.39-2.463a1 1 0 00-1.175 0l-3.39 2.463c-.784.57-1.838-.196-1.539-1.118l1.285-3.98a1 1 0 00-.363-1.118L2.98 9.407c-.783-.57-.38-1.81.588-1.81h4.187a1 1 0 00.95-.69l1.286-3.98z"/>
        </svg>
        <div class="text-xs font-medium text-amber-800" x-text="gpaStatusLabel()"></div>
      </div>
    </div>
  </div>

  <!-- Filter + KPI cards -->
  <div class="space-y-4">

    <!-- Term filter row -->
<div class="relative inline-flex items-center text-sm text-slate-500">
      <div class="relative inline-flex items-center">

        <!-- Button that toggles dropdown -->
        <button
          @click="showTermFilter = !showTermFilter"
          class="flex items-center gap-2 hover:text-slate-700">
          <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M3 4a1 1 0 011-1h16a1 1 0 01.78 1.625L15 11.25V17a1 1 0 01-.553.894l-4 2A1 1 0 019 19v-7.75L3.22 4.625A1 1 0 013 4z"/>
          </svg>
          <span>Filter by term</span>
        </button>

        <!-- Dropdown -->
        <div
          x-cloak
          x-show="showTermFilter"
          @click.outside="showTermFilter = false"
          x-transition:enter="transition ease-out duration-150"
          x-transition:enter-start="opacity-0 -translate-y-1"
          x-transition:enter-end="opacity-100 translate-y-0"
          x-transition:leave="transition ease-in duration-100"
          x-transition:leave-start="opacity-100 translate-y-0"
          x-transition:leave-end="opacity-0 -translate-y-1"
          class="absolute left-0 top-8 mt-1 w-40 rounded-xl border border-sand-300 bg-white shadow-lg p-2 z-20">

          <template x-for="term in gradeTerms" :key="term">
            <button
              @click="selectedTerm = term; showTermFilter = false"
              class="w-full text-left px-3 py-1.5 rounded-lg text-sm hover:bg-sand-100"
              :class="selectedTerm===term ? 'font-medium text-rust-600' : 'text-slate-700'">
              <span x-text="term"></span>
            </button>
          </template>
        </div>
      </div>
    </div>

    <!-- CONTENT BELOW FILTER -->
    <div class="mt-4 space-y-5">

      <!-- 1) KPI CARDS ROW -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">

        <!-- Average Grade -->
        <div class="rounded-2xl bg-white border border-sand-200/70 shadow-card p-4 flex flex-col justify-between">
          <div class="flex items-center justify-between text-xs text-slate-500">
            <span>Average Grade</span>
            <svg class="h-4 w-4 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M4 19h16M4 15l4-8 4 6 4-10 4 12"/>
            </svg>
          </div>
          <div class="mt-3 text-2xl font-semibold text-slate-900"
               x-text="averageGrade().toFixed(1) + '%'"></div>
          <div class="mt-3 h-2 rounded-full bg-slate-200 overflow-hidden">
            <div class="h-full rounded-full bg-slate-900"
                 :style="`width:${Math.min(averageGrade(),100)}%`"></div>
          </div>
        </div>

        <!-- Total Credits -->
        <div class="rounded-2xl bg-white border border-sand-200/70 shadow-card p-4 flex flex-col justify-between">
          <div class="flex items-center justify-between text-xs text-slate-500">
            <span>Total Credits</span>
            <svg class="h-4 w-4 text-rust-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5 5.754 5 4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18c1.746 0 3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
          </div>
          <div class="mt-3 text-2xl font-semibold text-slate-900" x-text="totalCredits()"></div>
          <div class="mt-1 text-xs text-slate-500">credits enrolled</div>
        </div>

        <!-- Courses this semester -->
        <div class="rounded-2xl bg-white border border-sand-200/70 shadow-card p-4 flex flex-col justify-between">
          <div class="flex items-center justify-between text-xs text-slate-500">
            <span>Courses</span>
            <svg class="h-4 w-4 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 6v6l4 2M5 4h14l-1 14H6L5 4z"/>
            </svg>
          </div>
          <div class="mt-3 text-2xl font-semibold text-slate-900" x-text="coursesCount()"></div>
          <div class="mt-1 text-xs text-slate-500">this semester</div>
        </div>

        <!-- Improvement -->
        <div class="rounded-2xl bg-amber-50 border border-amber-100 shadow-card p-4 flex flex-col justify-between">
          <div class="flex items-center justify-between text-xs text-amber-700">
            <span>Improvement</span>
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 17l6-6 4 4 8-8"/>
            </svg>
          </div>
          <div class="mt-3 text-2xl font-semibold text-amber-700"
               x-text="formatPercent(improvementPercent())"></div>
          <div class="mt-1 text-xs text-amber-700/80">since last term</div>
        </div>

      </div> <!-- end KPI grid -->

      <!-- 2) CHARTS ROW -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

        <!-- Performance Trend -->
   <!-- Performance Trend -->
<div class="rounded-2xl bg-white border border-sand-200/70 shadow-card p-5">
  <div class="flex items-center justify-between mb-3">
    <div>
      <div class="text-sm font-semibold text-slate-900">Performance Trend</div>
      <div class="text-xs text-slate-500">Your grades over the past 8 months</div>
    </div>
    <svg class="h-4 w-4 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none"
         viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
      <path stroke-linecap="round" stroke-linejoin="round"
            d="M4 19l6-6 4 4 6-12" />
    </svg>
  </div>

  <div class="mt-2">
    <!-- Pure SVG, no Alpine bindings -->
    <svg viewBox="0 0 320 190" class="w-full h-48">
      <!-- Horizontal grid lines -->
      <g stroke="#e5e7eb" stroke-width="1" stroke-dasharray="3 3">
        <line x1="60" y1="40"  x2="300" y2="40" />
        <line x1="60" y1="70"  x2="300" y2="70" />
        <line x1="60" y1="100" x2="300" y2="100" />
        <line x1="60" y1="130" x2="300" y2="130" />
        <line x1="60" y1="160" x2="300" y2="160" />
      </g>

      <!-- Y axis labels -->
      <g fill="#6b7280" font-size="11" text-anchor="end">
        <text x="55" y="163">80</text>
        <text x="55" y="133">85</text>
        <text x="55" y="103">90</text>
        <text x="55" y="73">95</text>
        <text x="55" y="43">100</text>
      </g>

      <!-- X axis labels -->
      <g fill="#6b7280" font-size="11" text-anchor="middle">
        <text x="60"  y="180">Mar</text>
        <text x="93"  y="180">Apr</text>
        <text x="126" y="180">May</text>
        <text x="159" y="180">Jun</text>
        <text x="192" y="180">Jul</text>
        <text x="225" y="180">Aug</text>
        <text x="258" y="180">Sep</text>
        <text x="291" y="180">Oct</text>
      </g>

      <!-- Line path (based on your 85–91 data) -->
      <!-- 80 → y=160, 100 → y=40, so each 1pt = 6px -->
      <!-- Values: 85,87,88,90,89,91,92,91 -->
      <!-- Y's:    130,118,112,100,106,94,88,94 -->
      <path
        d="M60 130 L93 118 L126 112 L159 100 L192 106 L225 94 L258 88 L291 94"
        fill="none"
        stroke="#f59e0b"
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-linejoin="round" />

      <!-- Points with simple hover title tooltips -->
      <g fill="#fbbf24" stroke="#fefce8" stroke-width="2">
        <circle cx="60"  cy="130" r="5">
          <title>Mar — average: 85</title>
        </circle>
        <circle cx="93"  cy="118" r="5">
          <title>Apr — average: 87</title>
        </circle>
        <circle cx="126" cy="112" r="5">
          <title>May — average: 88</title>
        </circle>
        <circle cx="159" cy="100" r="5">
          <title>Jun — average: 90</title>
        </circle>
        <circle cx="192" cy="106" r="5">
          <title>Jul — average: 89</title>
        </circle>
        <circle cx="225" cy="94"  r="5">
          <title>Aug — average: 91</title>
        </circle>
        <circle cx="258" cy="88"  r="5">
          <title>Sep — average: 92</title>
        </circle>
        <circle cx="291" cy="94"  r="5">
          <title>Oct — average: 91</title>
        </circle>
      </g>
    </svg>
  </div>
</div>


        <!-- Grade Distribution (legend + subjects only) -->
<div class="rounded-2xl bg-white border border-sand-200/70 shadow-card p-5">
  <div class="mb-3">
    <div class="text-sm font-semibold text-slate-900">Grade Distribution</div>
    <div class="text-xs text-slate-500">Breakdown of your letter grades</div>
  </div>

  <!-- Legend -->
  <div class="space-y-2 text-xs">
    <template x-for="seg in gradeDistribution()" :key="seg.key">
      <div class="flex items-center justify-between cursor-pointer"
           @mouseenter="hoveredGradeSlice = seg"
           @mouseleave="hoveredGradeSlice = null">
        <div class="flex items-center gap-2">
          <span class="h-3 w-3 rounded-full" :style="`background:${seg.color}`"></span>
          <span class="text-slate-700" x-text="seg.label"></span>
        </div>
        <span class="text-slate-500"
              x-text="seg.count + ' course' + (seg.count>1 ? 's' : '')"></span>
      </div>
    </template>
  </div>

  <!-- Subjects for active band -->
  <template x-if="activeGradeSlice()">
    <div class="mt-4 border-t border-sand-200 pt-3 text-xs">
      <div class="font-semibold text-slate-700 mb-1">Subjects</div>

      <template x-if="activeGradeSlice().courses.length === 0">
        <div class="text-slate-500 text-[11px]">No courses in this band.</div>
      </template>

      <ul class="space-y-0.5">
        <template x-for="c in activeGradeSlice().courses" :key="c.code">
          <li class="text-[11px] text-slate-600"
              x-text="c.code + ' · ' + c.title"></li>
        </template>
      </ul>
    </div>
  </template>
</div>


    
 <!-- ================= COURSE GRADES GRID ================= -->
<section class="mt-12">
  <div class="max-w-6xl mx-auto px-8">

    <!-- Header + sort -->
    <div class="flex items-center justify-between mb-8">
      <h2 class="text-xl font-semibold text-slate-900">Course Grades</h2>

      <div class="flex items-center gap-2 text-sm text-slate-600">
        <span>Sort by:</span>
        <select
          x-model="gradesSort"
          class="rounded-lg border border-sand-300 bg-white px-3 py-1.5 text-sm text-slate-700 focus:outline-none focus:ring-2 focus:ring-rust-300"
        >
          <option value="highest">Highest grade</option>
          <option value="lowest">Lowest grade</option>
          <option value="az">Course A–Z</option>
          <option value="za">Course Z–A</option>
        </select>
      </div>
    </div>

    <!-- Cards grid: 1 / 2 / 3 columns -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-10 gap-y-12">

      <template x-for="course in sortedCourses()" :key="course.code">
        <!-- SINGLE COURSE CARD -->
        <article class="rounded-[24px] bg-white border border-sand-200/80 shadow-card px-6 py-7 flex flex-col">

          <!-- Top: course title + badge -->
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-sm font-semibold text-slate-900" x-text="course.title"></div>
              <div class="text-xs text-slate-500" x-text="course.code + ' · ' + course.instructor"></div>
            </div>

            <!-- Letter grade badge -->
            <div
              class="h-7 px-2 rounded-full bg-amber-100 text-[11px] font-semibold text-amber-700 grid place-items-center"
              x-text="letterForGrade(course.grade)"
            ></div>
          </div>

          <!-- Current grade -->
          <div class="mt-5 text-center">
            <div class="text-[11px] uppercase tracking-wide text-slate-500">Current Grade</div>
            <div class="mt-1 text-3xl font-bold text-rust-500">
              <span x-text="(course.grade ?? 0).toFixed(1) + '%'"></span>
            </div>

            <div class="mt-1 flex items-center justify-center gap-1 text-xs"
                 :class="course.change >= 0 ? 'text-emerald-600' : 'text-rose-600'">
              <svg class="h-3 w-3"
                   :class="course.change >= 0 ? '' : 'rotate-180'"
                   xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M5 10l7-7 7 7M12 3v18"/>
              </svg>
              <span x-text="(course.change >= 0 ? '+' : '') + course.change.toFixed(1) + '%'"></span>
            </div>
          </div>

          <!-- Assignments progress -->
          <div class="mt-5">
            <div class="flex items-center justify-between text-[11px] text-slate-500 mb-1">
              <span>Assignments Progress</span>
              <span x-text="course.assignmentsDone + '/' + course.assignmentsTotal"></span>
            </div>
            <div class="h-2 rounded-full bg-slate-200 overflow-hidden">
              <div class="h-full rounded-full bg-slate-900"
                   :style="`width:${courseProgressPercent(course)}%`"></div>
            </div>
          </div>

          <!-- Recent results -->
          <div class="mt-5">
            <div class="text-[11px] font-semibold text-slate-700 mb-2">Recent Results</div>
            <div class="space-y-1.5 text-xs">
              <template x-for="item in course.assignments" :key="item.name">
                <div class="flex items-center justify-between rounded-xl bg-sand-50 px-3 py-2">
                  <div>
                    <div class="font-medium text-slate-800" x-text="item.name"></div>
                    <div class="text-[11px] text-slate-500" x-text="item.type"></div>
                  </div>
                  <div class="text-slate-700 font-semibold" x-text="item.score"></div>
                </div>
              </template>
            </div>
          </div>

          <!-- Button -->
          <button
            class="mt-5 w-full rounded-full bg-rust-500/90 hover:bg-rust-600 text-white text-sm py-2.5 flex items-center justify-center gap-1">
            <span>View Details</span>
            <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 5l7 7-7 7"/>
            </svg>
          </button>

        </article>
      </template>

    </div> <!-- end cards grid -->

  </div>
</section>
<!-- ================= END COURSE GRADES GRID ================= -->

 <!-- ================= END OF GRADES TAB ================= -->
